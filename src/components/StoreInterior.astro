---
import Face1 from './screens/Face1.astro'
import Face2 from './screens/Face2.astro'
import Face3 from './screens/Face3.astro'
import Face4 from './screens/Face4.astro'
---

<div class="cube-wrapper">
  <div class="cube" id="cube">
    <div class="face face-1"><Face1 /></div>
    <div class="face face-2"><Face2 /></div>
    <div class="face face-3"><Face3 /></div>
    <div class="face face-4">
      <Face4 />
    </div>
  </div>

  <!-- on-screen nav controls -->
  <button
    id="cube-prev"
    class="cube-nav cube-nav-left"
    type="button"
    aria-label="Previous screen"
  >
    <span class="cube-nav-icon">&lt;</span>
  </button>

  <button
    id="cube-next"
    class="cube-nav cube-nav-right"
    type="button"
    aria-label="Next screen"
  >
    <span class="cube-nav-icon">&gt;</span>
  </button>
</div>

<style>

  .cube-wrapper {
    width: 100vw;
    height: 100vh;
    position: relative;
    perspective: var(--cube-perspective);
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;

    .cube {
      width: var(--cube-size);
      height: var(--cube-size);
      transform-style: preserve-3d;
      transform: rotateY(var(--rotation));
      transition: transform 0.6s ease-in-out;
      position: relative;
    }

    .face {
      width: var(--cube-size);
      height: var(--cube-size);
      position: absolute;
      top: 50%;
      left: 50%;
      transform-style: preserve-3d;
      backface-visibility: hidden;
      background: #1a1a1a;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      transform: translate(-50%, -50%);
    }

    .face-1 {
      transform: translate(-50%, -50%) rotateY(0deg)
        translateZ(var(--cube-depth)) rotateY(180deg);
    }

    .face-2 {
      transform: translate(-50%, -50%) rotateY(90deg)
        translateZ(var(--cube-depth)) rotateY(180deg);
    }

    .face-3 {
      transform: translate(-50%, -50%) rotateY(180deg)
        translateZ(var(--cube-depth)) rotateY(180deg);
    }

    .face-4 {
      transform: translate(-50%, -50%) rotateY(270deg)
        translateZ(var(--cube-depth)) rotateY(180deg);
    }

    .cube-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: var(--cube-nav-size);
      height: var(--cube-nav-size);
      border-radius: var(--cube-nav-border-radius);
      border: none;
      background: var(--cube-nav-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      padding: 0;
      outline: none;
      backdrop-filter: blur(4px);
      transition:
        background 0.18s ease-out,
        transform 0.18s ease-out;
    }

    .cube-nav-left {
      left: var(--cube-nav-offset);
    }

    .cube-nav-right {
      right: var(--cube-nav-offset);
    }

    .cube-nav:hover {
      background: var(--cube-nav-bg-hover);
      transform: translateY(-50%) scale(1.08);
    }

    .cube-nav:active {
      transform: translateY(-50%) scale(0.95);
    }

    .cube-nav-icon {
      font-size: var(--cube-nav-icon-size);
      line-height: 1;
      user-select: none;
    }
  }
</style>

<script is:inline>
  // @ts-nocheck

  // parallax for face 4, desktop-only component now
  const scene = document.getElementById('parallax-scene-4')
  const layers = scene?.querySelectorAll('.layer') || []

  if (scene && layers.length) {
    document.addEventListener('mousemove', (e) => {
      const { clientX, clientY } = e
      const { innerWidth, innerHeight } = window

      const x = (clientX / innerWidth - 0.5) * 2
      const y = (clientY / innerHeight - 0.5) * 2

      layers.forEach((layer, index) => {
        const depth = (index + 1) * 8
        const offsetX = x * -depth
        const offsetY = y * -depth
        layer.style.transform = `translate(${offsetX}px, ${offsetY}px)`
      })
    })
  }

  let currentFace = 0

  function updateCubeRotation() {
    const angle = -90 * currentFace
    document.documentElement.style.setProperty('--rotation', `${angle}deg`)
  }

  function closeFace3ModalIfAny() {
    const modal = window.face3Modal
    if (modal && typeof modal.close === 'function') {
      modal.close()
    }
  }

  function rotateBy(delta) {
    closeFace3ModalIfAny()
    currentFace = currentFace + delta
    updateCubeRotation()
  }

  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') {
      rotateBy(1)
    }
    if (e.key === 'ArrowRight') {
      rotateBy(-1)
    }
  })

  const prevBtn = document.getElementById('cube-prev')
  const nextBtn = document.getElementById('cube-next')

  if (prevBtn) {
    prevBtn.addEventListener('click', () => {
      rotateBy(1)
    })
  }

  if (nextBtn) {
    nextBtn.addEventListener('click', () => {
      rotateBy(-1)
    })
  }

  updateCubeRotation()
</script>
